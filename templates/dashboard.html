{{define "dashboard"}}
{{template "header" .}}

<div class="page-header">
    <h2>Dashboard</h2>
    <p>Autenticação OAuth2 realizada com sucesso!</p>
</div>

{{if .Scopes}}
<div class="card">
    <h3>Escopos Solicitados</h3>
    <div class="user-info">
        <div class="info-row">
            <span class="label">Scopes:</span>
            <span class="value"><strong>{{.Scopes}}</strong></span>
        </div>
    </div>
</div>
{{end}}

{{if .UserInfo}}
<div class="card mt-3">
    <h3>Dados Obtidos do Escopo</h3>

    <h4 style="margin-top: 1.5rem; color: #2563eb; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem;">Identificação</h4>
    <div class="user-info">
        {{if .UserInfo.Sub}}
        <div class="info-row">
            <span class="label">Subject (Sub):</span>
            <span class="value">{{.UserInfo.Sub}}</span>
        </div>
        {{end}}
        {{if .UserInfo.Name}}
        <div class="info-row">
            <span class="label">Nome:</span>
            <span class="value"><strong>{{.UserInfo.Name}}</strong></span>
        </div>
        {{end}}
        {{if .UserInfo.CPF}}
        <div class="info-row">
            <span class="label">CPF:</span>
            <span class="value"><strong>{{.UserInfo.CPF}}</strong></span>
        </div>
        {{end}}
    </div>

    {{if or .UserInfo.Email .UserInfo.PhoneNumber}}
    <h4 style="margin-top: 1.5rem; color: #2563eb; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem;">Contato</h4>
    <div class="user-info">
        {{if .UserInfo.Email}}
        <div class="info-row">
            <span class="label">Email:</span>
            <span class="value">{{.UserInfo.Email}} {{if .UserInfo.EmailVerified}}<span style="color: #059669;">✓ verificado</span>{{else}}<span style="color: #dc2626;">✗ não verificado</span>{{end}}</span>
        </div>
        {{end}}
        {{if .UserInfo.PhoneNumber}}
        <div class="info-row">
            <span class="label">Telefone:</span>
            <span class="value">{{.UserInfo.PhoneNumber}} {{if .UserInfo.PhoneNumberVerified}}<span style="color: #059669;">✓ verificado</span>{{else}}<span style="color: #dc2626;">✗ não verificado</span>{{end}}</span>
        </div>
        {{end}}
    </div>
    {{end}}

    {{if .UserInfo.Address}}
    <h4 style="margin-top: 1.5rem; color: #2563eb; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem;">Endereço</h4>
    <div class="user-info">
        <div class="info-row">
            <span class="label">Endereço:</span>
            <span class="value">{{.UserInfo.Address}}</span>
        </div>
    </div>
    {{end}}

    {{if or .UserInfo.MembershipStatus .UserInfo.EmploymentStatus .UserInfo.MembershipType .UserInfo.UnionUnit}}
    <h4 style="margin-top: 1.5rem; color: #2563eb; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem;">Informações Sindicais</h4>
    <div class="user-info">
        {{if .UserInfo.MembershipStatus}}
        <div class="info-row">
            <span class="label">Status de Filiação:</span>
            <span class="value"><strong>{{.UserInfo.MembershipStatus}}</strong></span>
        </div>
        {{end}}
        {{if .UserInfo.MembershipType}}
        <div class="info-row">
            <span class="label">Tipo de Filiação:</span>
            <span class="value">{{.UserInfo.MembershipType}}</span>
        </div>
        {{end}}
        {{if .UserInfo.EmploymentStatus}}
        <div class="info-row">
            <span class="label">Status de Emprego:</span>
            <span class="value">{{.UserInfo.EmploymentStatus}}</span>
        </div>
        {{end}}
        {{if .UserInfo.UnionUnit}}
        <div class="info-row">
            <span class="label">Unidade Sindical:</span>
            <span class="value">{{.UserInfo.UnionUnit}}</span>
        </div>
        {{end}}
    </div>
    {{end}}

    {{if .UserInfo.Permissions}}
    <h4 style="margin-top: 1.5rem; color: #2563eb; border-bottom: 1px solid #e5e7eb; padding-bottom: 0.5rem;">Permissões</h4>
    <div class="user-info">
        <div class="info-row">
            <span class="label">Permissões Concedidas:</span>
            <span class="value">
                <ul style="margin: 0; padding-left: 1.5rem;">
                {{range .UserInfo.Permissions}}
                    <li><strong>{{.}}</strong></li>
                {{end}}
                </ul>
            </span>
        </div>
    </div>
    {{end}}
</div>
{{end}}

<div class="card mt-3">
    <h3>Tokens</h3>

    <div class="token-section">
        <h4>Access Token</h4>
        <textarea readonly class="token-field">{{.AccessToken}}</textarea>
    </div>

    {{if .RefreshToken}}
    <div class="token-section mt-2">
        <h4>Refresh Token</h4>
        <textarea readonly class="token-field">{{.RefreshToken}}</textarea>
    </div>
    {{end}}

    {{if .IDToken}}
    <div class="token-section mt-2">
        <h4>ID Token (JWT)</h4>
        <textarea readonly class="token-field">{{.IDToken}}</textarea>
    </div>
    {{end}}
</div>

<div class="card mt-3">
    <h3>Testar Endpoints</h3>
    <p>Use os botões abaixo para testar funcionalidades adicionais do OAuth2.</p>

    <div class="button-grid">
        <button hx-post="/test/refresh" hx-target="#test-result" class="btn btn-secondary">
            Refresh Token
        </button>

        <a href="/test/jwks" class="btn btn-secondary">
            Validar JWT com JWKS
        </a>

        <a href="/test/discovery" class="btn btn-secondary">
            OIDC Discovery
        </a>

        <button hx-post="/test/revoke" hx-target="#test-result" hx-confirm="Tem certeza? Isso vai revogar o token e encerrar a sessão." class="btn btn-danger">
            Revogar Token
        </button>
    </div>

    <div id="test-result" class="mt-3"></div>
</div>

<div class="card mt-3">
    <h3>Histórico de Requisições</h3>
    <p>Visualize todas as requisições HTTP realizadas durante o fluxo OAuth2.</p>
    <a href="/history" class="btn btn-primary">Ver Histórico Completo</a>
</div>

{{template "footer" .}}
{{end}}

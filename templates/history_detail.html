{{define "history_detail"}}
{{template "header" .}}

<!-- Breadcrumbs -->
<div class="breadcrumbs">
    <a href="/">Home</a> / <a href="/history">Histórico</a> / Requisição #{{.Entry.ID}}
</div>

<div class="page-header">
    <h2>Detalhes da Requisição #{{.Entry.ID}}</h2>
    <p>{{.Entry.EndpointType}} - {{.Entry.CreatedAt.Format "02/01/2006 15:04:05"}}</p>
    <a href="/history" class="btn btn-secondary">← Voltar para Histórico</a>
</div>

<details class="card collapsible-section" open>
    <summary>Request</summary>

    <div class="detail-row">
        <strong>Método:</strong> <span class="method method-{{.Entry.RequestMethod}}">{{.Entry.RequestMethod}}</span>
    </div>

    <div class="detail-row">
        <strong>URL:</strong> <code style="word-break: break-all;">{{.Entry.RequestURL}}</code>
    </div>

    <details class="collapsible-section">
        <summary>Headers</summary>
        <pre class="code-block"><code>{{range $key, $values := .RequestHeaders}}{{$key}}: {{range $values}}{{.}}{{end}}
{{end}}</code></pre>
    </details>

    {{if .Entry.RequestBody}}
    <details class="collapsible-section">
        <summary>Body</summary>
        {{if .PrettyRequestBody}}
        <pre class="code-block"><code class="language-json">{{.PrettyRequestBody}}</code></pre>
        {{else}}
        <pre class="code-block"><code>{{.Entry.RequestBody}}</code></pre>
        {{end}}
    </details>
    {{end}}
</details>

<details class="card mt-3 collapsible-section" open>
    <summary>Response</summary>

    <div class="detail-row">
        <strong>Status:</strong> <span class="status status-{{if lt .Entry.ResponseStatus 300}}success{{else if lt .Entry.ResponseStatus 400}}redirect{{else}}error{{end}}">{{.Entry.ResponseStatus}}</span>
    </div>

    <div class="detail-row">
        <strong>Duração:</strong> <span style="font-family: monospace; font-weight: 600;">{{.Entry.DurationMs}}ms</span>
    </div>

    <details class="collapsible-section">
        <summary>Headers</summary>
        <pre class="code-block"><code>{{range $key, $values := .ResponseHeaders}}{{$key}}: {{range $values}}{{.}}{{end}}
{{end}}</code></pre>
    </details>

    {{if .Entry.ResponseBody}}
    <details class="collapsible-section" open>
        <summary>Body</summary>
        {{if .PrettyResponseBody}}
        <pre class="code-block"><code class="language-json">{{.PrettyResponseBody}}</code></pre>
        {{else}}
        <pre class="code-block"><code>{{.Entry.ResponseBody}}</code></pre>
        {{end}}
    </details>
    {{end}}
</details>

{{template "footer" .}}
{{end}}
